<% content_for :title, "Ë≥ºÂÖ•ÊâãÁ∂ö„Åç - „É°„É´„Ç´„É™" %>

<%= content_for :head do %>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f8f8f8;
      line-height: 1.6;
      color: #333;
    }
    
    .header {
      background: white;
      padding: 16px 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-content {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 16px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #ea352d;
      text-decoration: none;
    }
    
    .breadcrumb {
      color: #888;
      font-size: 14px;
    }
    
    .breadcrumb a {
      color: #888;
      text-decoration: none;
    }
    
    .breadcrumb a:hover {
      text-decoration: underline;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 24px 16px;
    }
    
    .page-title {
      font-size: 24px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 32px;
      color: #333;
    }
    
    .form-section {
      background: white;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .product-summary {
      display: flex;
      gap: 16px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 16px;
    }
    
    .product-image {
      width: 80px;
      height: 80px;
      border-radius: 6px;
      overflow: hidden;
      flex-shrink: 0;
    }
    
    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .product-details {
      flex: 1;
    }
    
    .product-name {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    
    .product-price {
      font-size: 20px;
      font-weight: bold;
      color: #ea352d;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      transition: border-color 0.2s;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #ea352d;
      box-shadow: 0 0 0 2px rgba(234, 53, 45, 0.1);
    }
    
    .address-row {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 12px;
    }
    
    .saved-address {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .saved-address:hover {
      border-color: #ea352d;
      background: #fff5f5;
    }
    
    .saved-address.selected {
      border-color: #ea352d;
      background: #fff5f5;
    }
    
    .address-label {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .address-details {
      color: #666;
      font-size: 14px;
    }
    
    .payment-method {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .payment-method:hover {
      border-color: #ea352d;
      background: #fff5f5;
    }
    
    .payment-method.selected {
      border-color: #ea352d;
      background: #fff5f5;
    }
    
    .payment-icon {
      font-size: 24px;
    }
    
    .payment-info {
      flex: 1;
    }
    
    .payment-name {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .payment-desc {
      font-size: 14px;
      color: #666;
    }
    
    .radio-input {
      width: 20px;
      height: 20px;
      margin-left: auto;
    }
    
    .price-breakdown {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }
    
    .price-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 16px;
    }
    
    .price-row.total {
      font-size: 20px;
      font-weight: bold;
      color: #ea352d;
      border-top: 1px solid #ddd;
      padding-top: 12px;
      margin-top: 16px;
      margin-bottom: 0;
    }
    
    .coupon-section {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .coupon-input {
      display: flex;
      gap: 8px;
    }
    
    .coupon-btn {
      background: #666;
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      white-space: nowrap;
    }
    
    .coupon-btn:hover {
      background: #555;
    }
    
    .purchase-button {
      width: 100%;
      background: #ea352d;
      color: white;
      border: none;
      padding: 16px 24px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-bottom: 16px;
    }
    
    .purchase-button:hover {
      background: #d32f2f;
    }
    
    .purchase-button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .terms-notice {
      font-size: 14px;
      color: #666;
      text-align: center;
      line-height: 1.5;
    }
    
    .terms-notice a {
      color: #ea352d;
      text-decoration: none;
    }
    
    .terms-notice a:hover {
      text-decoration: underline;
    }
    
    .security-notice {
      background: #e8f5e8;
      border: 1px solid #c3e6c3;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .security-icon {
      font-size: 24px;
      color: #28a745;
    }
    
    .security-text {
      font-size: 14px;
      color: #155724;
    }
    
    .error-message {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 4px;
      padding: 8px 12px;
      margin-top: 8px;
      font-size: 14px;
      color: #721c24;
      display: none;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 16px 8px;
      }
      
      .form-section {
        padding: 16px;
        margin-bottom: 16px;
      }
      
      .product-summary {
        flex-direction: column;
        text-align: center;
      }
      
      .address-row {
        grid-template-columns: 1fr;
      }
      
      .payment-method {
        flex-direction: column;
        text-align: center;
      }
      
      .radio-input {
        margin: 12px auto 0;
      }
    }
  </style>
<% end %>

<header class="header">
  <div class="header-content">
    <a href="/" class="logo">„É°„É´„Ç´„É™</a>
    <div class="breadcrumb">
      <a href="/">„Éõ„Éº„É†</a> > 
      <a href="#">ÂïÜÂìÅË©≥Á¥∞</a> > 
      Ë≥ºÂÖ•ÊâãÁ∂ö„Åç
    </div>
  </div>
</header>

<div class="container">
  <h1 class="page-title">Ë≥ºÂÖ•ÊâãÁ∂ö„Åç</h1>

  <%= form_with url: "#", method: :post, local: true, id: "purchaseForm" do |form| %>
    <!-- ÂïÜÂìÅÊÉÖÂ†± -->
    <div class="form-section">
      <h2 class="section-title">Ë≥ºÂÖ•ÂïÜÂìÅ</h2>
      <div class="product-summary">
        <div class="product-image">
          <img src="https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=80&h=80&fit=crop" alt="iPhone 14 Pro">
        </div>
        <div class="product-details">
          <div class="product-name">iPhone 14 Pro 256GB „Çπ„Éö„Éº„Çπ„Éñ„É©„ÉÉ„ÇØ SIM„Éï„É™„Éº</div>
          <div class="product-price">¬• 145,000</div>
        </div>
      </div>
    </div>

    <!-- ÈÖçÈÄÅÂÖà‰ΩèÊâÄ -->
    <div class="form-section">
      <h2 class="section-title">ÈÖçÈÄÅÂÖà</h2>
      
      <div class="saved-address selected" onclick="selectAddress(this)">
        <div class="address-label">Ëá™ÂÆÖ</div>
        <div class="address-details">
          „Äí150-0001 Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫Á•ûÂÆÆÂâç1-1-1<br>
          Â±±Áî∞ Â§™ÈÉé
        </div>
      </div>
      
      <div class="saved-address" onclick="selectAddress(this)">
        <div class="address-label">ÂÆüÂÆ∂</div>
        <div class="address-details">
          „Äí100-0001 Êù±‰∫¨ÈÉΩÂçÉ‰ª£Áî∞Âå∫ÂçÉ‰ª£Áî∞1-1-1<br>
          Â±±Áî∞ Â§™ÈÉé
        </div>
      </div>

      <div class="form-group">
        <%= form.label :new_address, "Êñ∞„Åó„ÅÑ‰ΩèÊâÄ„ÇíËøΩÂä†", class: "form-label" %>
        <div class="address-row">
          <%= form.text_field :postal_code, class: "form-input", placeholder: "ÈÉµ‰æøÁï™Âè∑", maxlength: 8 %>
          <%= form.text_field :address, class: "form-input", placeholder: "ÈÉΩÈÅìÂ∫úÁúå„ÉªÂ∏ÇÂå∫Áî∫Êùë„ÉªÁï™Âú∞" %>
        </div>
        <%= form.text_field :building, class: "form-input", placeholder: "Âª∫Áâ©Âêç„ÉªÈÉ®Â±ãÁï™Âè∑", style: "margin-top: 12px;" %>
        <%= form.text_field :recipient_name, class: "form-input", placeholder: "ÂèóÂèñ‰∫∫Âêç", style: "margin-top: 12px;" %>
      </div>
    </div>

    <!-- ÊîØÊâï„ÅÑÊñπÊ≥ï -->
    <div class="form-section">
      <h2 class="section-title">ÊîØÊâï„ÅÑÊñπÊ≥ï</h2>
      
      <div class="payment-method selected" onclick="selectPayment(this)">
        <div class="payment-icon">üí≥</div>
        <div class="payment-info">
          <div class="payment-name">„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„Éâ</div>
          <div class="payment-desc">**** **** **** 1234ÔºàVISAÔºâ</div>
        </div>
        <%= form.radio_button :payment_method, "credit", class: "radio-input", checked: true %>
      </div>
      
      <div class="payment-method" onclick="selectPayment(this)">
        <div class="payment-icon">üè™</div>
        <div class="payment-info">
          <div class="payment-name">„Ç≥„É≥„Éì„ÉãÊîØÊâï„ÅÑ</div>
          <div class="payment-desc">Ë≥ºÂÖ•Âæå„Å´„ÅäÊîØÊâï„ÅÑÁî®Áï™Âè∑„Çí„ÅäÁü•„Çâ„Åõ„Åó„Åæ„Åô</div>
        </div>
        <%= form.radio_button :payment_method, "convenience", class: "radio-input" %>
      </div>
      
      <div class="payment-method" onclick="selectPayment(this)">
        <div class="payment-icon">üèß</div>
        <div class="payment-info">
          <div class="payment-name">ATMÊîØÊâï„ÅÑ</div>
          <div class="payment-desc">Pay-easyÂØæÂøúATM„Åß„ÅäÊîØÊâï„ÅÑ„Åè„Å†„Åï„ÅÑ</div>
        </div>
        <%= form.radio_button :payment_method, "atm", class: "radio-input" %>
      </div>
      
      <div class="payment-method" onclick="selectPayment(this)">
        <div class="payment-icon">üì±</div>
        <div class="payment-info">
          <div class="payment-name">„É°„É´„Éö„Ç§„Çπ„Éû„Éº„ÉàÊâï„ÅÑ</div>
          <div class="payment-desc">ÁøåÊúà„Åæ„Å®„ÇÅ„Å¶„ÅäÊîØÊâï„ÅÑ</div>
        </div>
        <%= form.radio_button :payment_method, "merpay", class: "radio-input" %>
      </div>
    </div>

    <!-- „ÇØ„Éº„Éù„É≥„Éª„Éù„Ç§„É≥„Éà -->
    <div class="form-section">
      <h2 class="section-title">„ÇØ„Éº„Éù„É≥„Éª„Éù„Ç§„É≥„Éà</h2>
      
      <div class="coupon-section">
        <%= form.label :coupon_code, "„ÇØ„Éº„Éù„É≥„Ç≥„Éº„Éâ", class: "form-label" %>
        <div class="coupon-input">
          <%= form.text_field :coupon_code, class: "form-input", placeholder: "„ÇØ„Éº„Éù„É≥„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ", id: "couponCode" %>
          <button type="button" class="coupon-btn" onclick="applyCoupon()">ÈÅ©Áî®</button>
        </div>
        <div class="error-message" id="couponError">„ÇØ„Éº„Éù„É≥„Ç≥„Éº„Éâ„ÅåÁÑ°Âäπ„Åß„Åô</div>
      </div>
      
      <div class="form-group">
        <%= form.label :points_used, "„Éù„Ç§„É≥„Éà‰ΩøÁî®", class: "form-label" %>
        <div style="display: flex; align-items: center; gap: 12px;">
          <%= form.number_field :points_used, class: "form-input", placeholder: "0", min: 0, max: 1500, style: "flex: 1;" %>
          <span style="color: #666;">/ 1,500P Âà©Áî®ÂèØËÉΩ</span>
        </div>
      </div>
    </div>

    <!-- ÊñôÈáëË©≥Á¥∞ -->
    <div class="form-section">
      <h2 class="section-title">„ÅäÊîØÊâï„ÅÑÈáëÈ°ç</h2>
      <div class="price-breakdown">
        <div class="price-row">
          <span>ÂïÜÂìÅ‰ª£Èáë</span>
          <span>¬• 145,000</span>
        </div>
        <div class="price-row">
          <span>ÈÄÅÊñô</span>
          <span>¬• 0</span>
        </div>
        <div class="price-row">
          <span>„ÇØ„Éº„Éù„É≥Ââ≤Âºï</span>
          <span id="couponDiscount">¬• 0</span>
        </div>
        <div class="price-row">
          <span>„Éù„Ç§„É≥„Éà‰ΩøÁî®</span>
          <span id="pointDiscount">¬• 0</span>
        </div>
        <div class="price-row total">
          <span>ÂêàË®à</span>
          <span id="totalAmount">¬• 145,000</span>
        </div>
      </div>
    </div>

    <!-- „Çª„Ç≠„É•„É™„ÉÜ„Ç£ÈÄöÁü• -->
    <div class="security-notice">
      <div class="security-icon">üîí</div>
      <div class="security-text">
        <strong>ÂÆâÂÖ®„Å™Ê±∫Ê∏à</strong><br>
        „ÅäÂÆ¢Êßò„ÅÆÂÄã‰∫∫ÊÉÖÂ†±„Å®„ÅäÊîØÊâï„ÅÑÊÉÖÂ†±„ÅØÊöóÂè∑Âåñ„Åï„Çå„Å¶‰øùË≠∑„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
      </div>
    </div>

    <!-- Ë≥ºÂÖ•„Éú„Çø„É≥ -->
    <%= form.submit "Ë≥ºÂÖ•„Åô„Çã", class: "purchase-button" %>
    
    <div class="terms-notice">
      Ë≥ºÂÖ•„Åô„Çã„Åì„Å®„Åß„ÄÅ<a href="/terms">Âà©Áî®Ë¶èÁ¥Ñ</a>„Åä„Çà„Å≥<a href="/privacy">„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº</a>„Å´ÂêåÊÑè„Åó„Åü„ÇÇ„ÅÆ„Å®„Åó„Åæ„Åô„ÄÇ<br>
      ÂïÜÂìÅ„Å´ÂïèÈ°å„Åå„ÅÇ„Å£„ÅüÂ†¥Âêà„ÅØ„ÄÅÂèñÂºïÂÆå‰∫ÜÂâç„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ
    </div>
  <% end %>
</div>

<%= content_for :javascript do %>
  <script>
    // ‰ΩèÊâÄÈÅ∏Êäû
    function selectAddress(element) {
      document.querySelectorAll('.saved-address').forEach(addr => {
        addr.classList.remove('selected');
      });
      element.classList.add('selected');
    }

    // ÊîØÊâï„ÅÑÊñπÊ≥ïÈÅ∏Êäû
    function selectPayment(element) {
      document.querySelectorAll('.payment-method').forEach(method => {
        method.classList.remove('selected');
      });
      element.classList.add('selected');
      
      const radio = element.querySelector('.radio-input');
      radio.checked = true;
    }

    // „ÇØ„Éº„Éù„É≥ÈÅ©Áî®
    function applyCoupon() {
      const couponCode = document.getElementById('couponCode').value.trim();
      const couponError = document.getElementById('couponError');
      const couponDiscount = document.getElementById('couponDiscount');
      
      if (couponCode === '') {
        couponError.textContent = '„ÇØ„Éº„Éù„É≥„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
        couponError.style.display = 'block';
        return;
      }
      
      // „Çµ„É≥„Éó„É´„ÇØ„Éº„Éù„É≥
      if (couponCode === 'WELCOME500') {
        couponDiscount.textContent = '¬• -500';
        couponError.style.display = 'none';
        updateTotal();
      } else if (couponCode === 'NEWUSER1000') {
        couponDiscount.textContent = '¬• -1,000';
        couponError.style.display = 'none';
        updateTotal();
      } else {
        couponError.textContent = '„ÇØ„Éº„Éù„É≥„Ç≥„Éº„Éâ„ÅåÁÑ°Âäπ„Åß„Åô';
        couponError.style.display = 'block';
        couponDiscount.textContent = '¬• 0';
        updateTotal();
      }
    }

    // ÂêàË®àÈáëÈ°çÊõ¥Êñ∞
    function updateTotal() {
      const basePrice = 145000;
      const couponText = document.getElementById('couponDiscount').textContent;
      const pointText = document.getElementById('pointDiscount').textContent;
      
      const couponAmount = couponText === '¬• 0' ? 0 : parseInt(couponText.replace(/[¬•\s,-]/g, ''));
      const pointAmount = pointText === '¬• 0' ? 0 : parseInt(pointText.replace(/[¬•\s,-]/g, ''));
      
      const total = basePrice + couponAmount + pointAmount;
      document.getElementById('totalAmount').textContent = `¬• ${total.toLocaleString()}`;
    }

    // „Éù„Ç§„É≥„Éà‰ΩøÁî®Ë®àÁÆó
    document.querySelector('input[type="number"]').addEventListener('input', function() {
      const points = parseInt(this.value) || 0;
      const maxPoints = 1500;
      
      if (points > maxPoints) {
        this.value = maxPoints;
        return;
      }
      
      document.getElementById('pointDiscount').textContent = points > 0 ? `¬• -${points.toLocaleString()}` : '¬• 0';
      updateTotal();
    });
  </script>
<% end %>